<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICSE Marks Calculator</title>
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAQr2Y8fFW3hMPIa0qaocDumhzfVwkDx_U",
            authDomain: "edith-a5bd8.firebaseapp.com",
            projectId: "edith-a5bd8",
            storageBucket: "edith-a5bd8.firebasestorage.app",
            messagingSenderId: "990954143521",
            appId: "1:990954143521:web:ea3c8df9ed9cd0185c8860"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const subjects = ["Physics", "Chemistry", "Maths", "Biology", "History", "Geography", "English-1", "English-2", "Second Language", "Computers"];

        function createInputs() {
            let subjectsContainer = document.getElementById("subjects");
            subjectsContainer.innerHTML = "";

            subjects.forEach((subj, i) => {
                let div = document.createElement("div");
                let label = document.createElement("label");
                label.innerText = subj + ": ";

                let input = document.createElement("input");
                input.type = "number";
                input.id = `mark${i}`;
                input.min = 0;
                input.max = i === 9 ? 100 : 80;
                input.oninput = () => document.getElementById(`error${i}`).innerText = "";

                let errorSpan = document.createElement("span");
                errorSpan.id = `error${i}`;
                errorSpan.className = "error";

                div.appendChild(label);
                div.appendChild(input);
                div.appendChild(errorSpan);
                subjectsContainer.appendChild(div);
            });
        }

        window.calculate = async function () {
            let marks = [];
            let hasError = false;

            for (let i = 0; i < subjects.length; i++) {
                let value = document.getElementById(`mark${i}`).value;
                let errorElement = document.getElementById(`error${i}`);

                if (value === "" || isNaN(value) || value < 0 || value > (i === 9 ? 100 : 80)) {
                    errorElement.innerText = "Please enter a valid number";
                    hasError = true;
                } else {
                    errorElement.innerText = "";
                    marks[i] = Number(value);
                }
            }

            if (hasError) return;

            let updatedMarks = marks.map((m, i) => i === 9 ? (m + 100) / 2 : m + 20);

            let categoryAverages = {
                "Science": (updatedMarks[0] + updatedMarks[1] + updatedMarks[3]) / 3,
                "Maths": updatedMarks[2],
                "Social Studies": (updatedMarks[4] + updatedMarks[5]) / 2,
                "English": (updatedMarks[6] + updatedMarks[7]) / 2,
                "Second Language": updatedMarks[8],
                "Computers": updatedMarks[9]
            };

            let resultBox = document.getElementById("results");
            resultBox.innerHTML = `<h3>Averages:</h3>`;
            for (let category in categoryAverages) {
                resultBox.innerHTML += `<p>${category}: ${categoryAverages[category].toFixed(2)}</p>`;
            }
            resultBox.style.display = "block";

            let username = prompt("Enter your name for the leaderboard:");
            if (username) {
                await addDoc(collection(db, "leaderboard"), {
                    name: username,
                    score: categoryAverages["Science"] + categoryAverages["Maths"] + categoryAverages["Social Studies"] + categoryAverages["English"] + categoryAverages["Second Language"] + categoryAverages["Computers"]
                });
            }
        };

        window.showLeaderboard = async function () {
            let leaderboard = document.getElementById("leaderboard");
            leaderboard.style.display = "block";
            let leaderboardList = document.getElementById("leaderboard-list");
            leaderboardList.innerHTML = "";

            let querySnapshot = await getDocs(collection(db, "leaderboard"));
            let scores = [];
            querySnapshot.forEach((doc) => {
                scores.push(doc.data());
            });
            
            scores.sort((a, b) => b.score - a.score);
            scores.forEach((entry, index) => {
                let li = document.createElement("li");
                li.innerText = `${index + 1}. ${entry.name} - ${entry.score.toFixed(2)}`;
                leaderboardList.appendChild(li);
            });
        };

        window.onload = createInputs;
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background-color: #121212; color: white; text-align: center; padding: 20px; }
        .container { max-width: 400px; background: #1e1e1e; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(255, 255, 255, 0.1); }
        button { margin-top: 10px; padding: 10px; background: #ff4c4c; color: white; border: none; cursor: pointer; width: 100%; transition: 0.3s; }
        button:hover { background: #ff1a1a; }
        .leaderboard-container { width: 250px; background: #1e1e1e; padding: 10px; border-radius: 10px; box-shadow: 0 4px 10px rgba(255, 255, 255, 0.1); display: none; text-align: left; }
        .leaderboard-container h3 { text-align: center; }
    </style>
</head>
<body>
    <div class="leaderboard-container" id="leaderboard">
        <h3>Leaderboard</h3>
        <ul id="leaderboard-list"></ul>
    </div>
    <div class="container">
        <h2>ICSE Marks Calculator</h2>
        <p>Enter marks (out of 80, Computers out of 100):</p>
        <div id="subjects" class="subjects-container"></div>
        <button onclick="calculate()">Calculate</button>
        <button onclick="showLeaderboard()">Leaderboard</button>
        <div id="results" class="results"></div>
    </div>
</body>
</html>
